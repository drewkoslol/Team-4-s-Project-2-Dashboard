<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team 4's Project 2 Dashboard v2.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a; /* bg-slate-900 */
        }
        .custom-select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url('data:image/svg+xml;utf8,<svg fill="white" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/><path d="M0 0h24v24H0z" fill="none"/></svg>');
            background-repeat: no-repeat;
            background-position-x: 98%;
            background-position-y: 50%;
            padding-right: 2rem;
        }
        .loader {
            border: 5px solid #f3f3f3; /* Light grey */
            border-top: 5px solid #3498db; /* Blue */
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            position: absolute;
            top: 50%;
            left: 50%;
            margin-left: -25px;
            margin-top: -25px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        #loader-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(15, 23, 42, 0.8);
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
        }
    </style>
</head>
<body class="bg-slate-900 text-gray-200">

    <div id="loader-container">
        <div class="loader"></div>
        <p class="ml-4 text-white">Fetching live data...</p>
    </div>

    <div class="container mx-auto p-4 md:p-8">
        
        <header class="text-center mb-8 md:mb-12">
            <h1 class="text-3xl md:text-5xl font-bold text-white">Team 4's Project Dashboard 2.0</h1>
            <p class="text-slate-500 mt-2 italic">Created by Drew Koskinen</p>
            <p class="text-slate-400 mt-2">Live progress for Prelim 2</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
            <div class="lg:col-span-1 bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-lg p-6 shadow-lg">
                <h2 class="text-xl font-bold text-white mb-4 text-center">Task Progress Overview</h2>
                <div class="relative h-64 w-64 mx-auto">
                    <canvas id="progressPieChart"></canvas>
                </div>
            </div>
            <div class="lg:col-span-2 bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-lg p-6 shadow-lg">
                <h2 class="text-xl font-bold text-white mb-4">Resources & Links</h2>
                <ul class="space-y-3">
                    <li><a href="#" class="flex items-center text-teal-400 hover:text-teal-300 transition-colors"><svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path></svg>Quizlet: Post-Prelim 1 Info</a></li>
                    <li><a href="#" class="flex items-center text-teal-400 hover:text-teal-300 transition-colors"><svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>WBS & Network Diagram Examples</a></li>
                    <li><a href="#" class="flex items-center text-teal-400 hover:text-teal-300 transition-colors"><svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg>Prelim 1 Review Sheet (Google Doc)</a></li>
                </ul>
                <p class="text-slate-400 text-sm mt-4">Tip: Paste your shareable links from Google Drive or Quizlet here by editing the HTML file.</p>
            </div>
        </div>

        <div class="space-y-4" id="task-list">
            <!-- Tasks will be dynamically inserted here -->
        </div> 
         
        <footer class="text-center mt-12">
            <p class="text-sm text-slate-500">Data is synced live from Google Sheets. Last update: <span id="last-updated"></span></p>
        </footer>

    </div>

    <script>
        // !!! IMPORTANT !!!
        // Replace this URL with the one you get from deploying your Google Apps Script.
        const GOOGLE_SHEET_URL = 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE';

        document.addEventListener('DOMContentLoaded', function() {
            let pieChart;
            const statusColors = {
                'Not Started': 'rgb(107, 114, 128)',   // gray-500
                'In Progress': 'rgb(251, 146, 60)',   // orange-400
                'Completed': 'rgb(34, 197, 94)'       // green-500
            };

            const loader = document.getElementById('loader-container');

            function showLoader(show) {
                loader.style.display = show ? 'flex' : 'none';
            }

            function updateTimestamp() {
                 document.getElementById('last-updated').textContent = new Date().toLocaleString();
            }

            function updatePieChart(tasks) {
                const ctx = document.getElementById('progressPieChart').getContext('2d');
                const statusCounts = { 'Not Started': 0, 'In Progress': 0, 'Completed': 0 };
                
                tasks.forEach(task => {
                    if (statusCounts.hasOwnProperty(task.Status)) {
                        statusCounts[task.Status]++;
                    }
                });

                const chartData = {
                    labels: Object.keys(statusCounts),
                    datasets: [{
                        data: Object.values(statusCounts),
                        backgroundColor: Object.values(statusColors),
                        borderColor: '#0f172a',
                        borderWidth: 3,
                        hoverOffset: 4
                    }]
                };

                if (pieChart) {
                    pieChart.data = chartData;
                    pieChart.update();
                } else {
                    pieChart = new Chart(ctx, {
                        type: 'doughnut',
                        data: chartData,
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'bottom',
                                    labels: {
                                        color: 'rgb(203, 213, 225)', // text-slate-300
                                        font: {
                                            size: 14
                                        }
                                    }
                                }
                            }
                        }
                    });
                }
            }

            function renderTasks(tasks) {
                const taskList = document.getElementById('task-list');
                taskList.innerHTML = ''; // Clear existing tasks
                tasks.forEach(task => {
                    const card = document.createElement('div');
                    card.className = 'task-card bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-lg p-4 md:p-5 shadow-lg transition-all duration-300 hover:border-teal-500/50';
                    card.dataset.id = task.ID;

                    const dueDate = task.DueDate ? new Date(task.DueDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric'}) : 'TBD';
                    const isTBD = !task.DueDate;
                    
                    card.innerHTML = `
                        <div class="grid grid-cols-1 md:grid-cols-12 gap-4 items-center">
                            <div class="md:col-span-4"><h2 class="font-bold text-lg text-white">${task.TaskName}</h2></div>
                            <div class="md:col-span-3">
                                <div class="flex items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-slate-400" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" /></svg>
                                    <span class="text-slate-300">${task.AssignedTo}</span>
                                </div>
                            </div>
                            <div class="md:col-span-2">
                                <div class="flex items-center font-medium ${isTBD ? 'text-slate-500' : ''}">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-slate-400" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" /></svg>
                                    <span>${dueDate}</span>
                                </div>
                            </div>
                            <div class="md:col-span-3 flex items-center gap-3">
                                <span class="status-indicator h-4 w-4 rounded-full flex-shrink-0" style="background-color: ${statusColors[task.Status]};" title="${task.Status}"></span>
                                <select class="status-select custom-select w-full bg-slate-700 border border-slate-600 rounded-md px-3 py-2 text-sm font-medium focus:outline-none focus:ring-2 focus:ring-teal-500">
                                     <option value="Not Started" ${task.Status === 'Not Started' ? 'selected' : ''}>Not Started</option>
                                     <option value="In Progress" ${task.Status === 'In Progress' ? 'selected' : ''}>In Progress</option>
                                     <option value="Completed" ${task.Status === 'Completed' ? 'selected' : ''}>Completed</option>
                                 </select>
                            </div>
                        </div>`;
                    taskList.appendChild(card);
                });
            }

            async function updateTaskStatus(taskId, newStatus) {
                showLoader(true);
                try {
                    await fetch(GOOGLE_SHEET_URL, {
                        method: 'POST',
                        mode: 'no-cors', // 'no-cors' is needed for simple POST requests to Apps Script
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ id: taskId, status: newStatus })
                    });
                    // After successfully sending the update, we fetch all data again
                    // to ensure the dashboard is in sync with the sheet.
                    await fetchSheetData(); 
                } catch (error) {
                    console.error('Error updating task:', error);
                    alert('Failed to update task status. Please try again.');
                } finally {
                    showLoader(false);
                }
            }

            async function fetchSheetData() {
                showLoader(true);
                if (GOOGLE_SHEET_URL === 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE') {
                    alert('Please update the GOOGLE_SHEET_URL in the script tag with your Apps Script URL.');
                    showLoader(false);
                    return;
                }
                try {
                    const response = await fetch(GOOGLE_SHEET_URL);
                    if (!response.ok) throw new Error('Network response was not ok.');
                    const tasks = await response.json();
                    renderTasks(tasks);
                    updatePieChart(tasks);
                    updateTimestamp();
                } catch (error) {
                    console.error('Error fetching data:', error);
                    alert('Could not fetch data from Google Sheet. Make sure the URL is correct and the script is deployed.');
                } finally {
                    showLoader(false);
                }
            }
            
            // Event listener for status changes
            document.getElementById('task-list').addEventListener('change', function(e) {
                if (e.target.classList.contains('status-select')) {
                    const card = e.target.closest('.task-card');
                    const taskId = card.dataset.id;
                    const newStatus = e.target.value;
                    updateTaskStatus(taskId, newStatus);
                }
            });

            // Initial data fetch
            fetchSheetData();
        });
    </script>
</body>
</html>



